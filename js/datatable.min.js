(function(c){var b=function(f,e){c.extend(true,this,{target:f||undefined,url:"undefined",searchKeys:{},check:true,thead:true,pagination:{pageSize:10,currentPage:1,pageGroup:[5,10,25,50],pageTemplate:'<div class="footer-left"><span>每页显示：</span><div class="down-group"><button type="button" class="selected"><span></span><i class="to-down"></i></button><ul class="dropdown"></ul></div></div><div class="footer-right pagination"><span>总共<i></i>条</span><ul><li class="prev">上一页</li><li class="next">下一页</li></ul></div>',complete:function(){},bindEvent:function(){}},ajaxOptions:{timeout:6000,async:true,type:"get",dataType:"json",data:{}},pullSuccess:function(){},pullComplete:function(){}},e);this.init()};b.prototype.init=function(){var e=c.extend(true,this.ajaxOptions,{data:{page:this.pagination.currentPage,pageSize:this.pagination.pageSize}});c.extend(true,e,this.searchKeys);this.pull(this.url,e)};b.prototype.pull=function(e,f){c.ajax({url:e,timeout:f.timeout,async:f.async,type:f.type,dataType:f.dataType,data:f.data,context:this,beforeSend:function(g){this.target.find(".cover").remove();this.target.append('<div class="cover"></div>')},success:function(h,g){this.fill(h);this.pullSuccess&&this.pullSuccess(h,this)},error:function(i,h,g){if(h==="timeout"){alert("请求超时！")}else{if(h==="parsererror"){alert("解析异常！\n"+g.message)}else{alert("未知错误！")}}},complete:function(h,g){this.pullComplete&&this.pullComplete(h.responseJSON);this.target.find(".cover").remove()}})};b.prototype.fill=function(g){var e=this.target.find(".datatable"),f=g.data;if(!f||!f.thead||!f.tbody){table.find("tbody").html("<tr><td>暂无数据！</td></tr>");return false}if(this.thead){e.find("thead").html(f.thead)}e.find("tbody").html(f.tbody);if(this.check){e.find("thead > tr").prepend('<th style="width:50px;text-align:center"><span class="checkbox" id="selectAll"></span></th>');e.find("tbody tr").prepend('<td style="text-align:center"><span class="checkbox" name="DTCheckbox"></span></td>');c("#selectAll").off().on("click",function(){if(c(this).hasClass("checked")){e.find(".checkbox").removeClass("checked");e.find(".checkbox").parents("tr").removeClass("selected")}else{e.find(".checkbox").addClass("checked");e.find(".checkbox").parents("tr").addClass("selected")}});e.find("tbody .checkbox").off().on("click",function(){var h=c(this);if(h.hasClass("checked")){h.removeClass("checked");h.parents("tr").removeClass("selected")}else{h.addClass("checked");h.parents("tr").addClass("selected")}})}this.paginate(g)};b.prototype.refresh=function(e){if(e){this.pagination.currentPage=1}var f=c.extend(true,this.ajaxOptions,{data:{page:this.pagination.currentPage,pageSize:this.pagination.pageSize}});c.extend(true,f.data,this.searchKeys);this.pull(this.url,f)};b.prototype.search=function(f,e){var g=c.extend(true,this.ajaxOptions,{data:{page:1,pageSize:this.pagination.pageSize}});c.extend(true,g.data,f);if(e){this.emptySearchKeys();c.extend(true,this.searchKeys,f)}this.pull(this.url,g)};b.prototype.paginate=function(e){var f=this.target.find(".pfooter");f.html(this.pagination.pageTemplate);a(f,this,e);this.pagination.complete&&this.pagination.complete(this,e);this.pagination.bindEvent&&this.pagination.bindEvent(this,e)};b.prototype.emptySearchKeys=function(){this.searchKeys={}};function a(j,o,f){var m=o.pagination,h=[],g=Math.ceil(f.total/m.pageSize),n=[],k=m.currentPage,l,e;for(e=0;e<m.pageGroup.length;e++){l=m.pageGroup[e];if(l===m.pageSize){j.find(".down-group .selected > span").text(l+"条");h.push('<li data-page="'+l+'" class="active">'+l+"条</li>")}else{h.push('<li data-page="'+l+'">'+l+"条</li>")}}j.find(".dropdown").html(h.join(""));j.find(".pagination > span > i").text(f.total);if(k===1){j.find(".pagination .prev").addClass("disabled")}if(k===g){j.find(".pagination .next").addClass("disabled")}for(e=k-1;;e--){if(e<=0){break}if(k-e>=3&&e>=3){n.unshift('<li class="leaveout">...</li>');n.unshift("<li>2</li>");n.unshift("<li>1</li>");break}n.unshift("<li>"+e+"</li>")}n.push('<li class="active">'+k+"</li>");for(e=k+1;;e++){if(e>g){break}if(e-k>=3&&e<=(g-3)){n.push('<li class="leaveout">...</li>');n.push("<li>"+(g-1)+"</li>");n.push("<li>"+g+"</li>");break}n.push("<li>"+e+"</li>")}j.find(".pagination .prev").after(n.join(""));d(j,o)}function d(f,e){f.find(".down-group .selected").off().on("click",function(){c(this).parent().find(".dropdown").show()});f.find(".down-group .dropdown > li").off().on("click",function(){var g=c(this).data("page");e.pagination.pageSize=g;c(this).parent().hide();e.refresh(true)});e.target.find(".pagination > ul > li").not(".disabled,.active,.leaveout").off().click("click",function(){var g=c(this);if(g.hasClass("prev")){--e.pagination.currentPage}else{if(g.hasClass("next")){++e.pagination.currentPage}else{e.pagination.currentPage=parseInt(c.trim(g.text()))}}e.refresh(false)})}window.DataTable=b})(jQuery);